services:
  redditarr:
    build: .
    container_name: redditarr
    ports:
      # Web UI port mapping - can be changed with PORT environment variable
      - "${PORT:-8481}:80"
    volumes:
      # Store database and application state
      - ./metadata:/app/metadata
      # Store downloaded media files
      - ./media:/app/media
    environment:
      # Reddit API credentials (from .env file)
      - REDDIT_CLIENT_ID
      - REDDIT_CLIENT_SECRET
      - REDDIT_USERNAME
      - REDDIT_PASSWORD
      # Container configuration
      - TZ=${TZ:-UTC}
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/api/health"]
      interval: 60s     # Check every minute
      timeout: 30s      # Allow more time for health check
      retries: 5        # More retries before marking unhealthy
      start_period: 30s # Give more time for initial startup